---
- name: Stop and disable apt-daily timer
  ansible.builtin.systemd_service:
    name: apt-daily.timer
    state: stopped
    enabled: false

- name: Stop and disable apt-daily-upgrade timer
  ansible.builtin.systemd_service:
    name: apt-daily-upgrade.timer
    state: stopped
    enabled: false

- name: Stop and disable unattended-upgrades service
  ansible.builtin.systemd_service:
    name: unattended-upgrades.service
    state: stopped
    enabled: false

- name: Stop and disable update-notifier-download timer
  ansible.builtin.systemd_service:
    name: update-notifier-download.timer
    state: stopped
    enabled: false
  failed_when: false

- name: Disable automatic package list updates and unattended upgrades
  ansible.builtin.copy:
    dest: /etc/apt/apt.conf.d/20auto-upgrades
    content: |
      APT::Periodic::Update-Package-Lists "0";
      APT::Periodic::Unattended-Upgrade "0";
      APT::Periodic::Download-Upgradeable-Packages "0";
      APT::Periodic::AutocleanInterval "0";
    owner: root
    group: root
    mode: "0644"
